<!-- TOPBAR BLANCO -->
<header class="topbar topbar--white" (click)="$event.stopPropagation()">
  <div class="topbar__inner">
    <div class="brand">
      <img class="logo" src="assets/images/logo-unah.png" alt="Logo UNAH" />
      <div class="brand__txt">
        <div class="brand__title">Sistema de Registro</div>
        <div class="brand__sub">Jefes de Departamento · DIPP</div>
      </div>
    </div>

    <div class="topbar__right">
      <!-- PERFIL (acciones aquí) -->
      <div class="profile">
        <button
          type="button"
          class="profile__btn"
          (click)="toggleDropdown('profile', $event)"
          [attr.aria-expanded]="openKey === 'profile'"
        >
          <span class="avatar" aria-hidden="true">
            <lucide-icon name="user" class="avatar__ico"></lucide-icon>
          </span>

          <span class="profile__txt">
          <span class="profile__name">Usuario</span>
          <span class="profile__role">
          <span class="onlineDot" aria-hidden="true"></span>
          Conectado
        </span>

          </span>

          <lucide-icon
            name="chevron-down"
            class="profile__caret"
            [class.is-up]="openKey === 'profile'"
          ></lucide-icon>
        </button>

        <!-- MENU PERFIL -->
        <div class="profile__panel" *ngIf="openKey === 'profile'">
          <a class="profileItem" href="#" (click)="$event.preventDefault()">
            <span class="pIco bg-slate">
              <lucide-icon name="key" class="ico"></lucide-icon>
            </span>
            <span class="pTxt">
              <span class="pTitle">Cambiar clave</span>
              <span class="pDesc">Seguridad de la cuenta</span>
            </span>
          </a>

          <a class="profileItem is-danger" href="#" (click)="$event.preventDefault()">
            <span class="pIco bg-red">
              <lucide-icon name="log-out" class="ico"></lucide-icon>
            </span>
            <span class="pTxt">
              <span class="pTitle">Cerrar sesión</span>
              <span class="pDesc">Salir del sistema</span>
            </span>
          </a>
        </div>
      </div>

      <!-- HAMBURGUESA (móvil) -->
      <button class="burger" type="button" (click)="toggleMobile()" aria-label="Abrir menú">
        <span class="burger__lines" aria-hidden="true"></span>
      </button>
    </div>
  </div>
</header>

<!-- NAV AZUL (STICKY) -->
<nav class="nav nav--blue" aria-label="Navegación principal" (click)="$event.stopPropagation()">
  <div class="nav__inner">
    <a class="nav__link is-home" href="#">Inicio</a>
    <a class="nav__link" href="#">Primer ingreso</a>

    <!-- DROPDOWNS desktop -->
    <div class="nav__ddWrap">
      <div class="dd" *ngFor="let d of dropdowns; trackBy: trackByKey">
        <button
          class="dd__btn"
          type="button"
          (click)="toggleDropdown(d.key, $event)"
          [attr.aria-expanded]="openKey === d.key"
        >
          <span class="dd__lbl">{{ d.label }}</span>
          <lucide-icon
            name="chevron-down"
            class="dd__caret"
            [class.is-up]="openKey === d.key"
          ></lucide-icon>
        </button>

        <div class="dd__panel"
             *ngIf="openKey === d.key"
             [ngClass]="d.accentClass">
          <div class="panelHead">
            <div class="panelHead__title">{{ d.title }}</div>
            <div class="panelHead__bar"></div>
          </div>

          <div class="panelList">
            <a
              class="panelItem"
              *ngFor="let it of d.items"
              [class.is-active]="it.active"
              [attr.href]="it.href || '#'"
              (click)="setActive(d.key, it.label); $event.preventDefault()"
            >
              <!-- ICONO -->
              <span class="badge" [ngClass]="getBadgeClass(d.key, it.label)">
                <lucide-icon class="ico" [name]="getIconName(d.key, it.label)"></lucide-icon>
              </span>

              <div class="panelItem__txt">
                <div class="panelItem__label">{{ it.label }}</div>
                <div class="panelItem__desc">{{ it.desc }}</div>
              </div>
            </a>
          </div>
        </div>
      </div>
    </div>

    <div class="nav__spacer"></div>

    <a class="nav__link" href="#">Contáctenos</a>
  </div>

  <!-- MOBILE PANEL -->
  <div class="mPanel" *ngIf="isMobileOpen">
    <div class="mPanel__inner">
      <a class="mLink is-home" href="#">Inicio</a>
      <a class="mLink" href="#">Primer ingreso</a>

      <div class="mDD" *ngFor="let d of dropdowns; trackBy: trackByKey">
        <button class="mDD__btn" type="button" (click)="toggleDropdown('m_' + d.key, $event)">
          <span>{{ d.label }}</span>
          <lucide-icon
            name="chevron-down"
            class="dd__caret"
            [class.is-up]="openKey === ('m_' + d.key)"
          ></lucide-icon>
        </button>

        <div class="mDD__panel" *ngIf="openKey === ('m_' + d.key)" [ngClass]="d.accentClass">
          <div class="panelHead">
            <div class="panelHead__title">{{ d.title }}</div>
            <div class="panelHead__bar"></div>
          </div>

          <div class="panelList">
            <a
              class="panelItem"
              *ngFor="let it of d.items"
              [class.is-active]="it.active"
              [attr.href]="it.href || '#'"
              (click)="setActive(d.key, it.label); $event.preventDefault()"
            >
              <!-- ICONO -->
              <span class="badge" [ngClass]="getBadgeClass(d.key, it.label)">
                <lucide-icon class="ico" [name]="getIconName(d.key, it.label)"></lucide-icon>
              </span>


              <div class="panelItem__txt">
                <div class="panelItem__label">{{ it.label }}</div>
                <div class="panelItem__desc">{{ it.desc }}</div>
              </div>
            </a>
          </div>
        </div>
      </div>

      <a class="mLink" href="#">Contáctenos</a>
    </div>
  </div>
</nav>
